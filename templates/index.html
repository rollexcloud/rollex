<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Downloader</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f7f7f7; }
        .container { max-width: 600px; margin-top: 50px; }
        .formats-table { margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="mb-4">YouTube Downloader</h2>
    <form id="urlForm">
        <div class="mb-3">
            <label for="url" class="form-label">YouTube URL</label>
            <input type="url" class="form-control" id="url" name="url" required>
        </div>
        <button type="submit" class="btn btn-primary">Get Formats</button>
    </form>
    <div id="formatsContainer" class="formats-table"></div>
</div>
<script>
    document.getElementById('urlForm').onsubmit = async function(e) {
        e.preventDefault();
        const url = document.getElementById('url').value;
        const res = await fetch('/get_formats', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'url=' + encodeURIComponent(url)
        });
        const data = await res.json();
        if (data.error) {
            document.getElementById('formatsContainer').innerHTML = '<div class="alert alert-danger">' + data.error + '</div>';
            return;
        }
        let html = '<form id="downloadForm"><div class="mb-3"><label for="format_id" class="form-label">Select Format</label><select class="form-select" id="format_id" name="format_id">';
        for (const f of data.formats) {
            html += `<option value="${f.format_id}">${f.ext} ${f.format_note} ${f.resolution} (${(f.filesize/1048576).toFixed(2)} MB)</option>`;
        }
        html += '</select></div><input type="hidden" name="url" value="' + url + '"><button type="submit" class="btn btn-success">Download</button></form>';
        document.getElementById('formatsContainer').innerHTML = html;
        document.getElementById('downloadForm').onsubmit = function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const params = new URLSearchParams();
            for (const pair of formData.entries()) {
            body: new URLSearchParams({url})
        });
        const data = await res.json();
        const container = document.getElementById('formatsContainer');
        if (data.error) {
            container.innerHTML = `<div class='alert alert-danger'>${data.error}</div>`;
            return;
        }
        let html = `<h4>${data.title}</h4><table class='table'><thead><tr><th>Format</th><th>Extension</th><th>Resolution</th><th>Filesize</th><th>Download</th></tr></thead><tbody>`;
        for (const f of data.formats) {
            html += `<tr><td>${f.format_note}</td><td>${f.ext}</td><td>${f.resolution}</td><td>${(f.filesize/1048576).toFixed(2)} MB</td><td><form method='POST' action='/download' style='display:inline;'><input type='hidden' name='url' value='${url}'><input type='hidden' name='format_id' value='${f.format_id}'><button class='btn btn-success btn-sm'>Download</button></form></td></tr>`;
        }
        html += `</tbody></table>`;
        container.innerHTML = html;
    }
</script>
</body>
</html>
